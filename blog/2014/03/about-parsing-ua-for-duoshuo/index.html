<!DOCTYPE html><html data-saber-ssr lang="zh-CN" class="serif" data-saber-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D,%22class%22:%7B%22ssr%22:%22serif%22%7D%7D"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.3"><meta data-saber-head="ssr" name="description" content="undefined"><meta data-saber-head="ssr" name="keywords" content="undefined"><meta data-saber-head="ssr" property="og:title" content="关于多说评论显示UserAgent"><meta data-saber-head="ssr" property="og:description" content="undefined"><meta data-saber-head="ssr" property="og:image" content="https://www.h404bi.comundefined"><meta data-saber-head="ssr" property="og:type" content="website"><meta data-saber-head="ssr" name="twitter:card" content="summary"><meta data-saber-head="ssr" name="twitter:creator" content="Chawye Hsu"><meta data-saber-head="ssr" name="twitter:title" content="关于多说评论显示UserAgent"><meta data-saber-head="ssr" property="twitter:image:src" content="https://www.h404bi.comundefined"> <title>关于多说评论显示UserAgent - The Art of Chawye Hsu</title> <link data-saber-head="ssr" rel="alternate" title="The Art of Chawye Hsu - Feed" href="/feed/atom.xml" type="application/atom+xml"><link data-saber-head="ssr" href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="true"><link data-saber-head="ssr" href="https://unpkg.com/" rel="preconnect" crossorigin="true"><link data-saber-head="ssr" href="https://unpkg.com/ionicons@4.6.3/dist/css/ionicons.min.css" rel="stylesheet"><link rel="stylesheet" href="/_saber/css/styles.b047de73.chunk.css">  </head><body><div id="_saber" data-server-rendered="true"><div class="tach-root"><header class="tach-header" data-v-4a730c26><div class="tach-wrapper" data-v-4a730c26><nav class="navbar" data-v-4a730c26><div class="container" data-v-4a730c26><div class="column navbar-brand" data-v-4a730c26><a href="/" class="navbar-item site-title router-link-active" data-v-4a730c26>
          The Art of Chawye Hsu
        </a> <span class="navbar-burger burger" data-v-4a730c26><span data-v-4a730c26></span> <span data-v-4a730c26></span> <span data-v-4a730c26></span></span></div> <div class="column navbar-menu" data-v-4a730c26><div class="navbar-end" data-v-4a730c26><a href="/blog" class="navbar-item router-link-active" data-v-4a730c26>
            Blog
          </a><a href="/guestbook" class="navbar-item" data-v-4a730c26>
            Guestbook
          </a><a href="/links" class="navbar-item" data-v-4a730c26>
            Links
          </a><a href="/about" class="navbar-item" data-v-4a730c26>
            About
          </a></div></div></div></nav></div></header> <main class="tach-main"><div class="tach-wrapper"><div class="page-content container"><article itemscope="itemscope" itemtype="https://schema.org/Article"><header class="page-header"><h1 class="page-title is-family-sans">关于多说评论显示UserAgent</h1> <div class="page-meta"><section class="page-datetime"><time datetime="2014-03-23T08:51:00.000Z" class="published">
                2014-03-23
              </time></section> <!----></div></header> <section class="page-alert outdated-alert notification">
          本文最后更新于 2079 天前（2014-Mar-23），其中的信息可能已经有所发展或者不再适合现阶段。
        </section> <section class="page-body"><Photoswipe auto=""><p>最近博客莫名其妙地多了十来个来自多说的访客，从统计去查看才发现有童鞋去多说讨论区发了个问题询问我博客的多说为什么会显示UserAgent，并且附上了我博客的一个链接，所以就有友友从多说跳转到我博客来围观了。</p> <p>那位询问的面条童鞋当时貌似也在微博At了我询问，后来我也回复了他，并附上了两种实现方法：其一就是可以通过使用Github上的<a rel="noopener noreferrer" target="_blank" href="https://github.com/huhuime/make_duoshuo_show_ua">make_duoshuo_show_ua</a>来实现UserAgent显示，作者huhu乃C8（chrome吧）小吧之一，常出没于C8和火狐吧。make_duoshuo_show_ua我是在逛某豆的博客看到的，我自己没用过，所以具体使用方法不清楚请自行前往Github查看=w=。其二则是我用的方法了，其实在多说的评论接口中，是附带了UA信息的，只是多说给的标准调用代码中并没有显示这部分内容。既然有接口了，自然就可以自定义输出咯。不过我并没有那么大牛自己写这么给力的duoshuo.js，我也是在逛别人博客的时候留意到有UA显示。于是就寻根，条件反射按F12键审查了代码，找到了调用的js文件，拷贝下来改了short_name就用上了。。具体在<a rel="noopener noreferrer" target="_blank" href="http://ysido.com/">阳光的博客</a>中找到调用的duoshuo.js就是了（拷贝下来可以使用 <a rel="noopener noreferrer" target="_blank" href="http://tool.lu">tool.lu</a>
盒子或者css-js工具格式化一下方便查看和修改）。但是这个duoshuo.js显示的UserAgent并不全面（比如最新的Win8.1），只是简单的支持了部分的UA，所以后来我稍微修改了判断函数，加上了 Win8.1，WinRT，WindowsPhone7/8/8.1，WinServer03/08/12，iOS7，Android 细分
2.2/2.3/4.0/4.1/4.2/4.3/4.4/，Linux细分Ubuntu/Debian/CentOS等，浏览器也细微改了一下。然后这样就能显示更多的UA了，虽然也是不能全面覆盖吧。</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">k</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/win/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 5.0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows 2000&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 5.1/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows XP&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 5.2/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Server 2003&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 6.0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Vista&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 6.1/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/server/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Server 2008&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Windows 7&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 6.2/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/server/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Server 2012&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Windows 8&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/nt 6.3/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows 8.1&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/phone/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/7/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Phone 7&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/8.0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Phone 8&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/8.1/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows Phone 8.1&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Windows Phone&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/arm/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Windows RT&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Windows&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/android/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/2.2/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 2.2&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/2.3/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 2.3&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/4.0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 4.0&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/4.1/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 4.1&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/4.2/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 4.2&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/4.3/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 4.3&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/4.4/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Android 4.4&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Android&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/linux/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/ubuntu/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Ubuntu&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/centos/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;CentOS&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/debian/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Debian&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Linux&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/mac/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/os 6_0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;iOS 6&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/os 7_0/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;iOS 7&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Mac OS X&quot;</span> <span class="token punctuation">:</span> a<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/unix/gi</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Unix&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Unknown OS&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p><strong>以上代码不能直接使用</strong> ！至于我修改后的duoshuo.js，因为被我混淆过，即使格式化后也不能阅读和修改（虽然使用没问题），所以就不提供了。而是提供一个UserAgent收集网站：
<a rel="noopener noreferrer" target="_blank" href="http://user-agent-string.info/">http://user-agent-string.info/</a>，这个网站基本上所有的UA都有了，如果要修改
duoshuo.js判断函数的话可以参考一下这个网站里的UA字符串咯。就是这样喵~</p> <p>因为最近多说有过好几次调用不了，一片白的情况，刚好Typecho又有多说评论同步插件（阳光出品），于是酝酿已久的用回原生评论就这样执行了额（有几个评论丢失了）。多说or原生，各有利弊吧。。顺便把扒来的主题用上鸟。评论也改成了平铺了，貌似我不怎么喜欢嵌套评论= =b，加上怡红公子的At插件，原生评论也挺好的哈。</p> <p>blablabla...</p></Photoswipe></section> <!----> <!----> <footer class="page-footer"></footer></article></div></div></main> <footer class="tach-footer footer"><div class="tach-wrapper"><div class="container"><!----> <section class="section"><div class="social-network"><ul><li><a target="_blank" rel="noopener" href="https://twitter.com/h404bi" class="icon ion-logo-twitter"></a></li><li><a target="_blank" rel="noopener" href="https://www.instagram.com/chawyehsu/" class="icon ion-logo-instagram"></a></li><li><a target="_blank" rel="noopener" href="https://github.com/h404bi" class="icon ion-logo-github"></a></li><li><a target="_blank" rel="noopener" href="https://steamcommunity.com/id/h404bi/" class="icon ion-logo-game-controller-b"></a></li><li><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=35631431" class="icon ion-ios-musical-notes"></a></li></ul></div></section> <section class="section"><div class="copyright">© 2015-2019 Chawye Hsu. Made with ♥ in Guangzhou</div></section></div></div></footer></div></div><script src="/_saber/js/styles.b047de73.js" defer></script><script src="/_saber/js/page--_posts-2014-03-23-about-parsing-ua-for-duoshuo-md.641beca6.js" defer></script><script src="/_saber/js/client.2ed39564.js" defer></script></body></html>
